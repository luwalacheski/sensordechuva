<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Checkout — VaralAuto</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body { font-family: Arial, sans-serif; background:#f9f9f9; margin:0; padding:0; }
    header { background:#047857; color:#fff; padding:20px 0; }
    header .container { display:flex; align-items:center; justify-content:space-between; max-width:1200px; margin:auto; padding:0 20px; }
    .logo { font-weight:bold; font-size:20px; }
    nav a { color:#fff; text-decoration:none; margin-left:20px; font-weight:600; }
    main { max-width:600px; margin:20px auto; padding:20px; background:#fff; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,0.1); }
    h1,h2 { color:#047857; }
    label { display:flex; flex-direction:column; margin-bottom:10px; font-weight:600; }
    input { padding:8px; border-radius:6px; border:1px solid #ccc; margin-top:4px; }
    .btn { padding:10px; background:#047857; color:#fff; border:none; border-radius:8px; cursor:pointer; font-weight:600; transition:0.2s; }
    .btn:hover { background:#065f46; }
    .ghost { background:#eee; color:#333; }
    #order-result { padding:12px; border-radius:10px; margin-top:20px; text-align:center; font-weight:bold; color:#065f46; background:#ecfdf5; }
    .cart-container { border:1px solid #ddd; border-radius:8px; padding:10px; background:#fefefe; margin-bottom:20px; }
    .cart-row { display:flex; justify-content:space-between; padding:8px 0; border-bottom:1px solid #eee; }
    .cart-row:last-child { border-bottom:none; }
    .small { font-size:0.9em; color:#555; }
  </style>
</head>
<body>

  <header>
    <div class="container">
      <div class="logo">VaralAuto</div>
      <nav>
        <a href="index.html">Produtos</a>
        <a href="sobre.html">Sobre nós</a>
        <a href="contato.html">Contato</a>
        <a href="carrinho.html">Carrinho</a>
      </nav>
    </div>
  </header>

  <main>
    <h1>Finalizar compra</h1>
    <p class="small">Preencha seus dados para concluir o pedido.</p>

    <!-- Carrinho -->
    <h2>Seu Carrinho</h2>
    <div id="cart-list" class="cart-container"></div>
    <div style="text-align:right;font-weight:bold;margin-bottom:30px;">
      Total: <span id="cart-total">R$ 0,00</span>
    </div>

    <!-- Formulário checkout -->
    <h2>Dados para Entrega</h2>
    <form id="checkout-form">
      <label>Nome completo
        <input type="text" id="nome" required />
      </label>
      <label>CPF
        <input type="text" id="cpf" placeholder="Somente números" maxlength="11" required />
      </label>
      <label>Telefone
        <input type="text" id="telefone" placeholder="(xx) xxxxx-xxxx" required />
      </label>
      <label>Endereço
        <input type="text" id="endereco" required />
      </label>
      <label>Cidade
        <input type="text" id="cidade" required />
      </label>
      <label>CEP
        <input type="text" id="cep" required />
      </label>
      <button type="submit" class="btn">Finalizar Compra</button>
      <a href="carrinho.html" class="btn ghost" style="display:inline-block;margin-top:10px;">Voltar ao carrinho</a>
    </form>

    <div id="order-result"></div>
  </main>

  <footer class="container" style="margin-top:40px;text-align:center;font-size:14px;color:#666;">
    VaralAuto — sistema de varal automático com sensor de chuva.
  </footer>

  <!-- Script do carrinho -->
  <script>
    // =========================
    // CARRINHO DE COMPRAS
    // =========================
    let cart = JSON.parse(localStorage.getItem('cart_demo') || '[]');

    function formatPrice(v) {
      return 'R$ ' + v.toFixed(2).replace('.', ',');
    }

    function saveCart() {
      localStorage.setItem('cart_demo', JSON.stringify(cart));
    }

    function renderCart() {
      const cartListEl = document.getElementById('cart-list');
      const cartTotalEl = document.getElementById('cart-total');
      if (!cartListEl || !cartTotalEl) return;

      cartListEl.innerHTML = '';
      if (cart.length === 0) {
        cartListEl.innerHTML = '<div class="small">Carrinho vazio</div>';
        cartTotalEl.textContent = 'R$ 0,00';
        return;
      }

      let total = 0;
      cart.forEach(item => {
        total += item.price * item.q;
        const row = document.createElement('div');
        row.className = 'cart-row';
        row.innerHTML = `
          <div>
            <div style="font-weight:600">${item.name}</div>
            <div class="small">${item.q} x ${formatPrice(item.price)}</div>
          </div>
          <div style="text-align:right">
            <div style="margin-bottom:6px">${formatPrice(item.price * item.q)}</div>
            <div>
              <button class="btn ghost" onclick="changeQty(${item.id}, -1)">-</button>
              <button class="btn ghost" onclick="changeQty(${item.id}, 1)">+</button>
              <button class="btn ghost" onclick="removeFromCart(${item.id})">Remover</button>
            </div>
          </div>
        `;
        cartListEl.appendChild(row);
      });

      cartTotalEl.textContent = formatPrice(total);
    }

    function changeQty(id, delta) {
      id = Number(id);
      const it = cart.find(c => Number(c.id) === id);
      if (!it) return;
      it.q += delta;
      if (it.q < 1) cart = cart.filter(c => Number(c.id) !== id);
      saveCart();
      renderCart();
    }

    function removeFromCart(id) {
      id = Number(id);
      cart = cart.filter(c => Number(c.id) !== id);
      saveCart();
      renderCart();
    }

    // =========================
    // CHECKOUT
    // =========================
    const checkoutForm = document.getElementById('checkout-form');
    if (checkoutForm) {
      checkoutForm.addEventListener('submit', ev => {
        ev.preventDefault();
        const nome = document.getElementById('nome').value.trim();
        const cpf = document.getElementById('cpf').value.trim();
        const telefone = document.getElementById('telefone').value.trim();
        const endereco = document.getElementById('endereco').value.trim();
        const cidade = document.getElementById('cidade').value.trim();
        const cep = document.getElementById('cep').value.trim();

        if (!nome || !cpf || !telefone || !endereco || !cidade || !cep) {
          alert('Preencha todos os campos.');
          return;
        }
        if (cart.length === 0) {
          alert('Seu carrinho está vazio.');
          return;
        }

        const order = {
          id: 'ORD-' + Date.now(),
          customer: { nome, cpf, telefone, endereco, cidade, cep },
          items: cart,
          total: cart.reduce((s,i)=>s+i.price*i.q,0),
          date: new Date().toISOString()
        };
        const orders = JSON.parse(localStorage.getItem('orders_demo')||'[]');
        orders.push(order);
        localStorage.setItem('orders_demo', JSON.stringify(orders));

        cart = [];
        saveCart();
        renderCart();

        const result = document.getElementById('order-result');
        if (result) {
          result.innerHTML = `
            <div>
              Obrigado pela preferência!<br>
              Pedido finalizado.<br>
              ID do pedido: ${order.id}<br>
              Total: ${formatPrice(order.total)}
            </div>`;
        }
      });
    }

    // =========================
    // FUNÇÕES GLOBAIS
    // =========================
    window.changeQty = changeQty;
    window.removeFromCart = removeFromCart;

    document.addEventListener('DOMContentLoaded', renderCart);
  </script>
</body>
</html>
